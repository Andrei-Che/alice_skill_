# Винный биодинамический календарь для Яндекс Алисы

[![Лицензия: MIT](https://img.shields.io/badge/Лицензия-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/python-3.8%2B-blue)](https://www.python.org/)
[![Звёзды](https://img.shields.io/github/stars/Andrei-Che/alice_skill_?style=social)](https://github.com/Andrei-Che/alice_skill_)

Этот репозиторий содержит навык для Яндекс Алисы, реализующий биодинамический винный календарь, основанный на работах Марии Тун. Навык подсказывает, подходит ли день для дегустации вина, ссылаясь на положение Луны, и объясняет рекомендации. Включает код для расчёта лунных позиций, интеграцию с API Алисы и документацию.

## Содержание
- [Описание](#описание)
- [Почему биодинамический календарь?](#почему-биодинамический-календарь)
- [Категории дней](#категории-дней)
- [Астрономический расчёт](#астрономический-расчёт)
- [Установка](#установка)
- [Использование](#использование)
- [Структура кода](#структура-кода)
- [Как внести вклад](#как-внести-вклад)
- [Лицензия](#лицензия)
- [Источники](#источники)

## Описание
Проект основан на создании голосового навыка для Яндекс Алисы, который работает как "Винный календарь". Пользователь может спросить: "Алиса, включи навык День вина" и получить рекомендацию, основанную на биодинамических принципах Марии Тун. Календарь делит дни на Фруктовые, Цветочные, Листовые и Корневые, влияющие на вкус вина.

Основные функции:
- Ежедневные рекомендации по вину в зависимости от положения Луны.
- Объяснения, опирающиеся на исследования Марии Тун.
- В доработке: рекомендации закусок или музыки.
- Реализовано на Python с использованием Yandex Dialogs SDK.

## Почему биодинамический календарь? Немного базы
Мария Тун (1922–2012), немецкий фермер и пионер биодинамики, разработала календарь в 1950-х, опираясь на идеи Рудольфа Штайнера. Она экспериментировала с посадкой растений в разные лунные фазы и публиковала ежегодные календари, включая "When Wine Tastes Best" ("Когда вино вкуснее всего"). Тун утверждала, что лунные ритмы влияют на жизненную силу растений, включая виноград, и, следовательно, на вкус вина. Хотя некоторые исследования (например, слепые дегустации) не подтвердили значительных различий во вкусе вина в разные дни, многие виноделы и сомелье следуют её рекомендациям.

Календарь помогает выбрать день для открытия бутылки: благоприятные дни подчёркивают вкус, неблагоприятные делают его плоским.

## Категории дней
Дни классифицируются по положению Луны в сидерическом зодиаке (реальные созвездия), связанному с элементами (Огонь, Земля, Воздух, Вода). Вот подробности:

| Категория        | Лучше для                   | Почему пить (или не пить) по Тун                                                                 | Созвездия (Элемент)             | Пример влияния на вино                  |
|------------------|-----------------------------|--------------------------------------------------------------------------------------------------|---------------------------------|-----------------------------------------|
| **Фруктовые дни** | Дегустация красных, насыщенных вин | Усиливает фруктовые ноты; Тун отмечала повышенную жизненную силу плодов. Пить для яркого вкуса. | Овен, Лев, Стрелец (Огонь)     | Вино кажется живым, с яркими ягодными ароматами. |
| **Цветочные дни** | Ароматные белые, розе, игристые | Подчёркивает цветочные ароматы; Тун связывала с элементом воздуха для элегантности. Хороши, но менее интенсивны. | Близнецы, Весы, Водолей (Воздух)| Свежие, с выраженными цветочными нотами. |
| **Листовые дни**  | Повседневное питьё, простые вина | Может казаться водянистым или травянистым; Тун отмечала доминирование воды, подавляющее баланс. Избегать премиум-вин. | Рак, Скорпион, Рыбы (Вода)     | Вино может быть разбавленным, с зелёными нотами. |
| **Корневые дни**  | Избегать дегустации         | Вкус плоский или горький; Тун связывала с акцентом на корни, подавляющим плоды. Худший выбор. | Телец, Дева, Козерог (Земля)   | Ароматы приглушены, вкус "закрытый".     |

Дополнительно: избегайте лунных узлов (пересечение эклиптики) и оппозиций — Тун советовала приостанавливать активности в такие моменты.

## Астрономический расчёт
Календарь основан на астрономии, а не астрологии — используются реальные орбитальные данные Луны.

### Пошаговый расчёт
1. **Орбита Луны**: Луна обходит Землю за ~27.3 дня (сидерический месяц). Позиция рассчитывается по эфемеридам (например, NASA's JPL Horizons).
2. **Проекция на зодиак**: Положение Луны проецируется на сидерический зодиак (реальные границы созвездий, определённые IAU).
   - Эклиптическая долгота = База + Скорость × Время + Пертурбации (гравитация Солнца/планет).
3. **Привязка к элементам**:
   - Огонь (Фруктовые): Овен, Лев, Стрелец.
   - Земля (Корневые): Телец, Дева, Козерог.
   - Воздух (Цветочные): Близнецы, Весы, Водолей.
   - Вода (Листовые): Рак, Скорпион, Рыбы.
4. **Инструменты**: Библиотеки `astropy` или `pyephem` для расчётов. Пример: долгота Луны ≈ 12.19°/день от точки весеннего равноденствия.

Пример кода (см. `lunar_calc.py`):
```python
from astropy.coordinates import get_moon, SkyCoord
from astropy.time import Time
import astropy.units as u

def get_lunar_day(date_str):
    t = Time(date_str)
    moon = get_moon(t)
    coord = SkyCoord(moon.ra, moon.dec, frame='icrs')
    longitude = coord.geocentrictrueecliptic.lon.degree  # Эклиптическая долгота
    # Привязка к зодиаку (упрощённо; полные границы в коде)
    signs = ['Овен', 'Телец', 'Близнецы', 'Рак', 'Лев', 'Дева',
             'Весы', 'Скорпион', 'Стрелец', 'Козерог', 'Водолей', 'Рыбы']
    sign_index = int(longitude / 30) % 12
    sign = signs[sign_index]
    # Привязка к элементам
    elements = {'Овен': 'Фруктовый', 'Телец': 'Корневой', ...}  # Полный словарь в коде
    return elements.get(sign, 'Неизвестно')
```

Для реального времени: интегрируйте с API, например, Swiss Ephemeris.

## Установка
1. Клонируйте репозиторий: `git clone https://github.com/yourusername/wine-calendar-alice.git`
2. Установите зависимости: `pip install -r requirements.txt` (включает `yandex-dialogs-sdk`, `astropy`)
3. Настройте Яндекс Диалоги: создайте навык, добавьте вебхук на ваш сервер.
4. Запустите локально: `python app.py`

Требования:
- Python 3.8+
- Библиотеки: `astropy`, `flask` (для вебхука), `requests`

## Использование
- Разверните на сервере (например, Heroku).
- В Алисе: "Запусти Винный Календарь" → "Какой сегодня день для вина?"
- Пример ответа: "Сегодня Фруктовый день — идеально для красного! По Марии Тун, вкус будет ярким."

Настройте ответы в `dialogs.json`.

## Структура кода
```
wine-calendar-alice/
├── app.py              # Основное приложение Flask для вебхука Алисы
├── lunar_calc.py       # Расчёт положения Луны
├── dialogs.json        # Пример скриптов диалогов для Алисы
├── requirements.txt    # Зависимости
├── README.md           # Этот файл
└── tests/              # Тесты (например, test_lunar.py)
```

## Как внести вклад
Приветствуются Pull Request'ы! Фокус на:
- Точности расчётов Луны.
- Новых функциях (например, API для подбора закусок).
- Тестах для граничных случаев (например, лунные узлы).

Форкните, создайте ветку, отправьте PR. Следуйте [Contributor Covenant](https://www.contributor-covenant.org).

## Лицензия
Лицензия MIT. См. файл [LICENSE](LICENSE).

## Источники
- Книги Марии Тун: "The Biodynamic Sowing and Planting Calendar."
- Астрономия: Система Horizons от NASA для эфемерид.
- Исследования: Platter et al. (2010) о вариативности вкуса вина.

Поставьте звезду, если проект полезен! 🍷 Вопросы? Откройте issue.
